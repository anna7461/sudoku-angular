.board {
  display: grid;
  grid-template-columns: repeat(3, 1fr);
  border: 1px solid var(--color-border-darkest);
  width: fit-content;
  position: relative;

  &.disabled {
    opacity: var(--color-button-disabled-opacity);
    pointer-events: none;

    .cell {
      cursor: not-allowed;
    }
  }
}

.box {
  display: grid;
  grid-template-columns: repeat(3, 50px);
  grid-template-rows: repeat(3, 50px);
  border: 1px solid var(--color-border-darkest);
}

.cell {
  position: relative;
  border: 1px solid var(--color-border-light);
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 22px;
  cursor: pointer;
  user-select: none;
  font-weight: bold;
  min-height: 44px;
  transition: all 0.2s ease;

  /* Enhanced focus styles for accessibility */
  &:focus-visible {
    outline: 2px solid var(--color-focus-ring, #3b82f6);
    outline-offset: 2px;
    box-shadow: 0 0 0 4px var(--color-focus-ring-light, rgba(59, 130, 246, 0.3));
    z-index: 10;
  }

  :host-context(.theme-dark-mode) {
    background-color: var(--color-bg-white);
  }

  &.fixed {
    color: var(--color-cell-fixed);
  }

  &.selected {
    background-color: var(--color-cell-selected);
    color: var(--color-cell-selected-text);
    border: 2px solid var(--color-cell-selected);
    /* Enhanced focus for selected cell */
    &:focus-visible {
      outline: 2px solid var(--color-text-white, #ffffff);
      outline-offset: 1px;
    }
  }

  &.correct {
    color: var(--color-cell-correct);
    background-color: transparent;
    font-weight: 600; /* Slightly bolder for better readability */
  }

  &.error {
    color: var(--color-cell-error);
    background-color: transparent;
    font-weight: 600; /* Slightly bolder for better readability */

    .main-number {
      color: var(--color-cell-error) !important;
    }
  }

  &.fixed-selected {
    background-color: var(--color-cell-highlighted);
    border: 2px solid var(--color-border-darkest);
    color: var(--color-cell-fixed);
    position: relative;

    &:hover {
      background-color: var(--color-cell-highlighted-border);
    }

    /* Enhanced focus for fixed selected cell */
    &:focus-visible {
      outline: 2px solid var(--color-focus-ring, #3b82f6);
      outline-offset: 1px;
    }
  }

  &.number-highlighted {
    background-color: var(--color-cell-number-highlighted) !important;
    color: var(--color-cell-selected-text);
    border: 1px solid var(--color-cell-number-highlighted);

    .note {
      color: var(--color-warning);
      font-weight: bold;
    }

    /* Enhanced focus for number highlighted cell */
    &:focus-visible {
      outline: 2px solid var(--color-text-white, #ffffff);
      outline-offset: 1px;
    }
  }

  &.related-highlighted {
    background-color: var(--color-cell-highlighted);
    border: 1px solid var(--color-cell-highlighted-border);
  }

  &.current-number-highlighted {
    background-color: var(--color-primary);
    color: var(--color-cell-selected-text);
    border: 1px solid var(--color-primary);

    .note {
      color: var(--color-success);
      font-weight: bold;
    }

    /* Enhanced focus for current number highlighted cell */
    &:focus-visible {
      outline: 2px solid var(--color-text-white, #ffffff);
      outline-offset: 1px;
    }
  }

  // Override related highlighting for selected cell
  &.selected.related-highlighted {
    background-color: var(--color-primary);
    border: 2px solid var(--color-primary);
  }

  // Override number highlighting for selected cell
  &.selected.number-highlighted {
    background-color: var(--color-primary);
    border: 2px solid var(--color-primary);

    .main-number {
      color: var(--color-cell-selected-text);
    }

    .note {
      color: var(--color-cell-selected-text);
    }
  }

  &.selected.number-highlighted.error {
    background-color: var(--color-cell-error) !important;
    color: var(--color-cell-selected-text);
    border: 2px solid var(--color-cell-error);

    .main-number {
      color: var(--color-cell-selected-text) !important;
    }
  }

  &.number-highlighted.error {
    color: var(--color-cell-error) !important;
    background-color: var(--color-cell-highlighted) !important;
    border: 1px solid var(--color-cell-highlighted-border);

    .main-number {
      color: var(--color-cell-error) !important;
    }
  }

  .notes-grid {
    position: absolute;
    top: 2px;
    left: 2px;
    right: 2px;
    bottom: 2px;
    font-size: 9px;
    display: grid;
    grid-template-columns: repeat(3, 1fr);
    grid-template-rows: repeat(3, 1fr);
    color: var(--color-cell-notes);
    grid-gap: 2px;

    .note {
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: bold;
      border-radius: 2px;
      transition: all 0.2s ease;
      /* Improved accessibility for notes */
      min-height: 9px;
      min-width: 6px;

      &.has-note {
        color: var(--color-cell-notes);
        font-weight: 600; /* Better readability */
      }

      &.note-error {
        color: var(--color-danger);
        background-color: var(--color-cell-selected-text);
        border: 1px solid var(--color-danger);
      }

      &.note-selected {
        background-color: var(--color-primary);
        color: var(--color-cell-selected-text);
        border: 1px solid var(--color-primary);
      }

      &.note-highlighted {
        background-color: var(--color-primary);
        color: var(--color-cell-selected-text);
        font-weight: bold;
        transform: scale(1.1);
        box-shadow: 0 0 4px rgba(0, 0, 0, 0.3);
        border: 1px solid var(--color-primary);

        // Ensure sufficient contrast for accessibility
        &:focus {
          outline: 2px solid var(--color-primary);
          outline-offset: 1px;
        }
      }
    }
  }
}

/* High contrast mode support */
@media (prefers-contrast: high) {
  .board {
    border: 3px solid var(--color-text-darkest, #000000);
  }

  .box {
    border: 3px solid var(--color-text-darkest, #000000);
  }

  .cell {
    border: 2px solid var(--color-text-darkest, #000000);

    &:focus-visible {
      outline: 3px solid var(--color-text-darkest, #000000);
      outline-offset: 1px;
    }
  }
}

/* Reduced motion support */
@media (prefers-reduced-motion: reduce) {
  .cell {
    transition: none;

    .note {
      transition: none;
    }
  }
}

// Mobile Responsive Styles
@media (max-width: 768px) {
  .board {
    width: 100%;
    max-width: 100vw;
  }

  .box {
    grid-template-columns: repeat(3, 45px);
    grid-template-rows: repeat(3, 45px);
  }

  .cell {
    font-size: 20px;
    min-height: 40px; /* Slightly smaller but still accessible */
  }
}

@media (max-width: 480px) {
  .box {
    grid-template-columns: repeat(3, 40px);
  }

  .cell {
    font-size: 18px;
    min-height: 36px; /* Maintain accessibility */
  }
}

@media (max-width: 360px) {
  .box {
    grid-template-columns: repeat(3, 35px);
  }

  .cell {
    font-size: 16px;
    min-height: 32px; /* Minimum accessible size */
  }
}
