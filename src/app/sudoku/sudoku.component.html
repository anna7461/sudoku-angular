<div>
  <div class="puzzle-info-container">
    <div class="score text-center"><span>Score: {{ getCurrentScore() }}</span></div>
    <div class="mistakes">
      <i class="fa-solid fa-exclamation-triangle margin-right-4"></i>
      <span>Mistakes: {{ getMistakeCount() }} / 3</span>
    </div>
    <div class="difficulty text-center"><span>{{ getCurrentDifficulty() }}</span></div>
    <app-timer
      class="time"
      [isGameActive]="isGameActive()"
      [isGamePaused]="isGamePaused"
      [isGameCompleted]="hasWonGameCached"
      [gameStartTime]="gameStartTime"
      [savedElapsedTime]="totalGameTime"
      (timerUpdate)="onTimerUpdate($event)">
    </app-timer>
  </div>

  <!-- Loading Indicator -->
  <div *ngIf="isLoading" class="loading-indicator">
    <div class="loading-spinner"></div>
    <p>Generating puzzle...</p>
  </div>

  <div class="sudoku-container" #sudokuContainer>
    <div class="game-content">
      <app-board
        *ngIf="!isLoading && boxes && boxes.length > 0"
        [boxes]="boxes"
        [selectedBoxIndex]="selectedBoxIndex"
        [selectedCellIndex]="selectedCellIndex"
        [currentNumber]="currentNumber"
        [selectedNumber]="selectedNumber"
        [disabled]="!isGameActive()"
        (cellSelected)="onCellSelected($event)">
      </app-board>

      <!-- Debug Info for Mobile -->
      <div *ngIf="!isLoading && (!boxes || boxes.length === 0)" class="debug-info">
        <p>Debug: No puzzle data available</p>
        <p>Boxes length: {{ boxes.length || 0 }}</p>
        <p>Loading state: {{ isLoading }}</p>
        <button (click)="forceGeneratePuzzle()">Force Generate Puzzle</button>
      </div>

      <app-board-controls
      class="mobile-only"
        *ngIf="!isLoading && boxes && boxes.length > 0"
        [notesMode]="notesMode"
        [numberFirstMode]="numberFirstMode"
        [canUndo]="canUndo()"
        [disabled]="!isGameActive()"
        (undo)="undo()"
        (resetNotes)="resetNotes()"
        (toggleNotesMode)="toggleNotesMode()"
        (toggleNumberFirstMode)="toggleNumberFirstMode()"
        (hint)="provideHint()">
      </app-board-controls>
      <app-number-pad
        *ngIf="!isLoading && boxes && boxes.length > 0"
        [currentNumber]="currentNumber"
        [selectedNumber]="selectedNumber"
        [numberFirstMode]="numberFirstMode"
        [disabled]="!isGameActive()"
        [remainingCounts]="calculateRemainingCounts()"
        (numberClick)="onNumberPadClick($event)"
        (toggleNumberFirstMode)="onNumberPadToggleMode($event)">
      </app-number-pad>
    </div>
  </div>
</div>

<app-board-controls
class="desktop-only"
        *ngIf="!isLoading && boxes && boxes.length > 0"
        [notesMode]="notesMode"
        [numberFirstMode]="numberFirstMode"
        [canUndo]="canUndo()"
        [disabled]="!isGameActive()"
        (undo)="undo()"
        (resetNotes)="resetNotes()"
        (toggleNotesMode)="toggleNotesMode()"
        (toggleNumberFirstMode)="toggleNumberFirstMode()"
        (hint)="provideHint()">
      </app-board-controls>

    <!-- Pause Dialog Component -->
    <app-pause-dialog ngSkipHydration></app-pause-dialog>

    <!-- Game Over Dialog Component -->
    <app-game-over-dialog
      [isVisible]="showGameOverDialog"
      [gameStats]="gameOverStats"
      (resetGame)="onGameOverResetGame()"
      (newGame)="onGameOverNewGame($event)"
      (close)="onGameOverClose()">
    </app-game-over-dialog>

    <!-- Congratulations Dialog Component -->
    <app-congratulations-dialog
      [isVisible]="showCongratulationsDialog"
      [puzzleStats]="congratulationsStats"
      (resetGame)="onCongratulationsResetGame()"
      (newGame)="onCongratulationsNewGame($event)"
      (close)="onCongratulationsClose()">
    </app-congratulations-dialog>
